## æ˜æ—¥ã‹ã‚‰ä½¿ãˆã‚‹ Java 9 ä¾¿åˆ©æ©Ÿèƒ½ 5 é¸

<a href="https://twitter.com/k_kato" target="_blank"><img style="border-radius: 50% !important;" src="img/twitter.jpg" width="200px" alt="Keisuke KATO"></a> 

#### Javaãƒ„ãƒ¼ãƒ«å‹‰å¼·ä¼šï¼ ç¦å²¡@[AIPã‚«ãƒ•ã‚§](http://javatoolstudy-fukuoka.connpass.com/event/43600/)

2016/11/4 <a href="https://twitter.com/k_kato" target="_blank">@k_kato</a>



## About me

<!-- .slide: data-background="rgb(0, 43, 54)" -->
```js
const profile = {timeline: [
    {year: 2010, lang: "Java"   },
    {year: 2011, lang: "C#"     },
    {year: 2012, lang: "C#"     },
    {year: 2013, lang: "Java"   },
    {year: 2014, lang: "C#"     },
    {year: 2015, lang: "Java 8" }
]};
```
```js
const addTimeline2016 = (profile) => {
    profile.timeline.push({
        year: 2016,
        lang: "Java 8",
        job: "Web",
        do: "Modern Web Development with C# (100Î¼%)",
        try: "Microsoft MVP",
        catch: "Failed"
    });
}
```



## Java 9 ãƒªãƒªãƒ¼ã‚¹ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç‰©èª

* ğŸ˜„ 2016 å¹´ 1 æœˆ - 4 æœˆ ãƒªãƒªãƒ¼ã‚¹äºˆå®š
<!-- .element: class="fragment" data-fragment-index="10" -->
* ğŸ“† ãƒªã‚¹ã‚±
<!-- .element: class="fragment" data-fragment-index="20" -->
* ğŸ˜ƒ 2016 å¹´ 9 æœˆ 22 æ—¥ ãƒªãƒªãƒ¼ã‚¹äºˆå®š
<!-- .element: class="fragment" data-fragment-index="30" -->
* ğŸ“† ãƒªã‚¹ã‚±
<!-- .element: class="fragment" data-fragment-index="40" -->
* ğŸ˜… 2017 å¹´ 3 æœˆ 23 æ—¥ ãƒªãƒªãƒ¼ã‚¹äºˆå®š
<!-- .element: class="fragment" data-fragment-index="50" -->
* ğŸ“† ãƒªã‚¹ã‚±
<!-- .element: class="fragment" data-fragment-index="60" -->
* ğŸ˜± 2017 å¹´ 7 æœˆ 27 æ—¥ ãƒªãƒªãƒ¼ã‚¹æ±ºå®šï¼Ÿ
<!-- .element: class="fragment" data-fragment-index="70" -->
* âœ‹ ã“ã‚Œã¯ã‚‚ã—ã‹ã—ã¦â€¦
<!-- .element: class="fragment" data-fragment-index="80" -->
* ğŸ‘ ç´æœŸãŒå³ã—ã„ç¾ä»£æƒ…å ±ç¤¾ä¼šã«èº«ã‚’æŒºã—ã¦ä¸€çŸ³ã‚’æŠ•ã˜ãŸ Java 9
<!-- .element: class="fragment" data-fragment-index="90" -->
<img src="img/mmm.jpg" height="200px" />
<img src="img/dm.jpg" height="200px" />
<!-- .element: class="fragment" data-fragment-index="90" -->



## Java 9 æ©Ÿèƒ½ä¸€è¦§

### [87 æ©Ÿèƒ½ï¼ï¼](http://openjdk.java.net/projects/jdk9/)
<!-- .element: class="fragment" data-fragment-index="10" -->
<div style="font-size: 16px">
102: <a href="http://openjdk.java.net/jeps/102">Process API Updates</a>
110: <a href="http://openjdk.java.net/jeps/110">HTTP 2 Client</a>
143: <a href="http://openjdk.java.net/jeps/143">Improve Contended Locking</a>
158: <a href="http://openjdk.java.net/jeps/158">Unified JVM Logging</a>
165: <a href="http://openjdk.java.net/jeps/165">Compiler Control</a>
193: <a href="http://openjdk.java.net/jeps/193">Variable Handles</a>
197: <a href="http://openjdk.java.net/jeps/197">Segmented Code Cache</a>
199: <a href="http://openjdk.java.net/jeps/199">Smart Java Compilation, Phase Two</a>
200: <a href="http://openjdk.java.net/jeps/200">The Modular JDK</a>
201: <a href="http://openjdk.java.net/jeps/201">Modular Source Code</a>
211: <a href="http://openjdk.java.net/jeps/211">Elide Deprecation Warnings on Import Statements</a>
212: <a href="http://openjdk.java.net/jeps/212">Resolve Lint and Doclint Warnings</a>
213: <a href="http://openjdk.java.net/jeps/213">Milling Project Coin</a>
214: <a href="http://openjdk.java.net/jeps/214">Remove GC Combinations Deprecated in JDK 8</a>
215: <a href="http://openjdk.java.net/jeps/215">Tiered Attribution for javac</a>
216: <a href="http://openjdk.java.net/jeps/216">Process Import Statements Correctly</a>
217: <a href="http://openjdk.java.net/jeps/217">Annotations Pipeline 2.0</a>
219: <a href="http://openjdk.java.net/jeps/219">Datagram Transport Layer Security (DTLS)</a>
220: <a href="http://openjdk.java.net/jeps/220">Modular Run-Time Images</a>
221: <a href="http://openjdk.java.net/jeps/221">Simplified Doclet API</a>
222: <a href="http://openjdk.java.net/jeps/222">jshell: The Java Shell (Read-Eval-Print Loop)</a>
223: <a href="http://openjdk.java.net/jeps/223">New Version-String Scheme</a>
224: <a href="http://openjdk.java.net/jeps/224">HTML5 Javadoc</a>
225: <a href="http://openjdk.java.net/jeps/225">Javadoc Search</a>
226: <a href="http://openjdk.java.net/jeps/226">UTF-8 Property Files</a>
227: <a href="http://openjdk.java.net/jeps/227">Unicode 7.0</a>
228: <a href="http://openjdk.java.net/jeps/228">Add More Diagnostic Commands</a>
229: <a href="http://openjdk.java.net/jeps/229">Create PKCS12 Keystores by Default</a>
231: <a href="http://openjdk.java.net/jeps/231">Remove Launch-Time JRE Version Selection</a>
232: <a href="http://openjdk.java.net/jeps/232">Improve Secure Application Performance</a>
233: <a href="http://openjdk.java.net/jeps/233">Generate Run-Time Compiler Tests Automatically</a>
235: <a href="http://openjdk.java.net/jeps/235">Test Class-File Attributes Generated by javac</a>
236: <a href="http://openjdk.java.net/jeps/236">Parser API for Nashorn</a>
237: <a href="http://openjdk.java.net/jeps/237">Linux/AArch64 Port</a>
238: <a href="http://openjdk.java.net/jeps/238">Multi-Release JAR Files</a>
240: <a href="http://openjdk.java.net/jeps/240">Remove the JVM TI hprof Agent</a>
241: <a href="http://openjdk.java.net/jeps/241">Remove the jhat Tool</a>
243: <a href="http://openjdk.java.net/jeps/243">Java-Level JVM Compiler Interface</a>
244: <a href="http://openjdk.java.net/jeps/244">TLS Application-Layer Protocol Negotiation Extension</a>
245: <a href="http://openjdk.java.net/jeps/245">Validate JVM Command-Line Flag Arguments</a>
246: <a href="http://openjdk.java.net/jeps/246">Leverage CPU Instructions for GHASH and RSA</a>
247: <a href="http://openjdk.java.net/jeps/247">Compile for Older Platform Versions</a>
248: <a href="http://openjdk.java.net/jeps/248">Make G1 the Default Garbage Collector</a>
249: <a href="http://openjdk.java.net/jeps/249">OCSP Stapling for TLS</a>
250: <a href="http://openjdk.java.net/jeps/250">Store Interned Strings in CDS Archives</a>
251: <a href="http://openjdk.java.net/jeps/251">Multi-Resolution Images</a>
252: <a href="http://openjdk.java.net/jeps/252">Use CLDR Locale Data by Default</a>
253: <a href="http://openjdk.java.net/jeps/253">Prepare JavaFX UI Controls &amp; CSS APIs for Modularization</a>
254: <a href="http://openjdk.java.net/jeps/254">Compact Strings</a>
255: <a href="http://openjdk.java.net/jeps/255">Merge Selected Xerces 2.11.0 Updates into JAXP</a>
256: <a href="http://openjdk.java.net/jeps/256">BeanInfo Annotations</a>
257: <a href="http://openjdk.java.net/jeps/257">Update JavaFX/Media to Newer Version of GStreamer</a>
258: <a href="http://openjdk.java.net/jeps/258">HarfBuzz Font-Layout Engine</a>
259: <a href="http://openjdk.java.net/jeps/259">Stack-Walking API</a>
260: <a href="http://openjdk.java.net/jeps/260">Encapsulate Most Internal APIs</a>
261: <a href="http://openjdk.java.net/jeps/261">Module System</a>
262: <a href="http://openjdk.java.net/jeps/262">TIFF Image I/O</a>
263: <a href="http://openjdk.java.net/jeps/263">HiDPI Graphics on Windows and Linux</a>
264: <a href="http://openjdk.java.net/jeps/264">Platform Logging API and Service</a>
265: <a href="http://openjdk.java.net/jeps/265">Marlin Graphics Renderer</a>
266: <a href="http://openjdk.java.net/jeps/266">More Concurrency Updates</a>
267: <a href="http://openjdk.java.net/jeps/267">Unicode 8.0</a>
268: <a href="http://openjdk.java.net/jeps/268">XML Catalogs</a>
269: <a href="http://openjdk.java.net/jeps/269">Convenience Factory Methods for Collections</a>
270: <a href="http://openjdk.java.net/jeps/270">Reserved Stack Areas for Critical Sections</a>
271: <a href="http://openjdk.java.net/jeps/271">Unified GC Logging</a>
272: <a href="http://openjdk.java.net/jeps/272">Platform-Specific Desktop Features</a>
273: <a href="http://openjdk.java.net/jeps/273">DRBG-Based SecureRandom Implementations</a>
274: <a href="http://openjdk.java.net/jeps/274">Enhanced Method Handles</a>
275: <a href="http://openjdk.java.net/jeps/275">Modular Java Application Packaging</a>
276: <a href="http://openjdk.java.net/jeps/276">Dynamic Linking of Language-Defined Object Models</a>
277: <a href="http://openjdk.java.net/jeps/277">Enhanced Deprecation</a>
278: <a href="http://openjdk.java.net/jeps/278">Additional Tests for Humongous Objects in G1</a>
279: <a href="http://openjdk.java.net/jeps/279">Improve Test-Failure Troubleshooting</a>
280: <a href="http://openjdk.java.net/jeps/280">Indify String Concatenation</a>
281: <a href="http://openjdk.java.net/jeps/281">HotSpot C++ Unit-Test Framework</a>
282: <a href="http://openjdk.java.net/jeps/282">jlink: The Java Linker</a>
283: <a href="http://openjdk.java.net/jeps/283">Enable GTK 3 on Linux</a>
284: <a href="http://openjdk.java.net/jeps/284">New HotSpot Build System</a>
285: <a href="http://openjdk.java.net/jeps/285">Spin-Wait Hints</a>
287: <a href="http://openjdk.java.net/jeps/287">SHA-3 Hash Algorithms</a>
288: <a href="http://openjdk.java.net/jeps/288">Disable SHA-1 Certificates</a>
289: <a href="http://openjdk.java.net/jeps/289">Deprecate the Applet API</a>
290: <a href="http://openjdk.java.net/jeps/290">Filter Incoming Serialization Data</a>
292: <a href="http://openjdk.java.net/jeps/292">Implement Selected ECMAScript 6 Features in Nashorn</a>
294: <a href="http://openjdk.java.net/jeps/294">Linux/s390x Port</a>
295: <a href="http://openjdk.java.net/jeps/295">Ahead-of-Time Compilation</a>

Last update: 2016/10/26 23:19 UTC
</div>
<!-- .element: class="fragment" data-fragment-index="10" -->



## jshell

* [Kulla Project](http://openjdk.java.net/projects/kulla/) ~~(è”µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ)~~
* [JEP 222: jshell: The Java Shell (a Java REPL)](https://bugs.openjdk.java.net/browse/JDK-8043364)
* REPL (ğŸ‘ãƒ¬ãƒ—ãƒ«  ğŸ‘ãƒªãƒ—ãƒ«)
<!-- .element: class="fragment" data-fragment-index="10" -->
* Read-eval-print loop
<!-- .element: class="fragment" data-fragment-index="20" -->
* èª­è¾¼-è©•ä¾¡-è¡¨ç¤º ç¹°ã‚Šè¿”ã™
<!-- .element: class="fragment" data-fragment-index="20" -->
```bash
jshell> 1+1
$1 ==> 2
```
<!-- .element: class="fragment" data-fragment-index="20" -->
![http://blog.arungupta.me/jdk9-repl-getting-started/](img/jdk9-repl.png)
<!-- .element: class="fragment" data-fragment-index="20" -->



## jshell ã‚’ã¯ã˜ã‚ã‚‹ã«ã¯ï¼Ÿ

* æ–¹æ³• 1: JDK 9 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ç›´æ¥å®Ÿè¡Œ
  * [JDKâ„¢ 9 Early Access Releases](https://jdk9.java.net/download/) ã‹ã‚‰ JDK ã‚’ D&I
```bash
$JAVA_HOME/bin/jshell
```

* æ–¹æ³• 2: Docker ä¸Šã§å®Ÿè¡Œ
  * [Dockerã‚’ä½¿ã£ã¦Java9ã‚’è¶…é«˜é€Ÿã«è©¦ã™](https://qiita.com/koduki/items/c4fb0276cc0d9a1a08c0)@[koduki](https://qiita.com/koduki)
```bash
docker run marvambass/oracle-java9 java -version
docker run -it marvambass/oracle-java9 jshell
```



### jshell ã§ Java 9 Stream æ–°æ©Ÿèƒ½ã‚’ç¢ºèªã™ã‚‹

```bash
jshell> import java.util.function.*
jshell> Predicate<Integer> lessThanZero = x -> x < 0
jshell> List.of(-2, -1, 0, 1, 2).
   ...> stream().
   ...> dropWhile(lessThanZero).
   ...> forEach(System.out::println)
0
1
2
jshell> /exit
```

* `Tab` ã§è£œå®Œ
* å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ `import` ã§èª­ã¿è¾¼ã‚€
* è¤‡æ•°è¡Œã¯ `.` ã§çµ‚ç«¯ã™ã‚‹
* çµ‚äº†ã¯ `/exit`
* ãƒ˜ãƒ«ãƒ—ã¯ `/?`
* ã‚»ãƒŸã‚³ãƒ­ãƒ³ ãƒ¬ã‚¹ Javaï¼ç´ æ™´ã‚‰ã—ã„ï¼
<!-- .element: class="fragment" data-fragment-index="10" -->



## jshell ã‚’ä½¿ã£ãŸæ„Ÿæƒ³

* REPL ãªã‚‰ IDE ãƒ‡ãƒãƒƒã‚¬ãƒ¼æ™‚ã®å³æ™‚è©•ä¾¡ã®æ–¹ãŒé«˜æ©Ÿèƒ½ã§ã¯ï¼Ÿ
<!-- .element: class="fragment" data-fragment-index="20" -->
  * jshell ã¯ import ã®è‡ªå‹•è£œå®Œæ©Ÿèƒ½ãŒãªã„(Â´ï¼›Ï‰ï¼›ï½€)
<!-- .element: class="fragment" data-fragment-index="20" -->
  * IntelliJ IDEA ãªã‚‰ Evaluate Expression ä¸­ã« import ã‚‚è‡ªå‹•è£œå®Œ
<!-- .element: class="fragment" data-fragment-index="20" -->
* Java ã®å…¬å¼ REPL ãªã®ã«ãƒ¡ã‚½ãƒƒãƒ‰å‚ç…§ã®è£œå®ŒãŒã§ããªã„(Â´ï¼›Ï‰ï¼›ï½€)
<!-- .element: class="fragment" data-fragment-index="30" -->
  * `System.out::` + `Tab` ã§è£œå®Œå€™è£œãŒè¡¨ç¤ºã•ã‚Œãªã„
<!-- .element: class="fragment" data-fragment-index="30" -->
* javac ã¨ jshell ã«æŒ™å‹•å·®ãŒã‚ã‚‹(Â´ï¼›Ï‰ï¼›ï½€)
<!-- .element: class="fragment" data-fragment-index="40" -->
  * ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã«ã¤ã„ã¦ï¼ŒJDK 9 javac ã ã¨äº‹å®Ÿä¸Šã® final ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ« ã‚¨ãƒ©ãƒ¼ãªã®ã«ï¼ŒREPL ã ã¨ä¸ç´”ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã¨ã—ã¦è©•ä¾¡ã•ã‚Œã‚‹
<!-- .element: class="fragment" data-fragment-index="40" -->

```java
import java.util.function.*;

public class Main {
    public static void main(String... args) {
        int x = 0;
        Supplier<Integer> add = () -> x++;
        System.out.println(add.get());
    }
}
```
<!-- .element: class="fragment" data-fragment-index="40" -->



## Java Module System

* [Project Jigsaw](http://openjdk.java.net/projects/jigsaw/)
* [JSR 376: Modularization of the JDK under Project Jigsaw (Java Module System)](http://openjdk.java.net/projects/jigsaw/doc/draft-java-module-system-requirements-12)
* JAR Hell: åŒä¸€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³é•ã„ã§è¡çªã—ãŸå ´åˆãªã©ã§ï¼Œçªç„¶æŒ™å‹•ãŒå¤‰ã‚ã‚‹ã“ã¨ãŒã‚ã‚‹
<!-- .element: class="fragment" data-fragment-index="10" -->
 * java -cp "commons-math3-3.0.jar;commons-math3-3.6.1.jar;" ã§å®Ÿè¡Œã—ãŸå ´åˆï¼Œ3.0 ãŒå…ˆå‹ã§ï¼Œ3.6.1 ã¯ä½¿ãˆãªã„
<!-- .element: class="fragment" data-fragment-index="10" -->
* ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å¯è¦–æ€§ã‚’åˆ¶å¾¡ã™ã‚‹æ©Ÿèƒ½
<!-- .element: class="fragment" data-fragment-index="15" -->
 * ã‚¯ãƒ©ã‚¹ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¯ public/protected/private ãŒã‚ã‚‹ãŒï¼Œãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã¯ãªã‹ã£ãŸ
<!-- .element: class="fragment" data-fragment-index="15" -->
* ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¬é–‹ã™ã‚‹å´ãŒï¼Œå…¬é–‹/éå…¬é–‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å®£è¨€ã§ãã‚‹
<!-- .element: class="fragment" data-fragment-index="20" -->
* ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹å´ãŒï¼Œä½¿ç”¨/æœªä½¿ç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å®£è¨€ã§ãã‚‹
<!-- .element: class="fragment" data-fragment-index="20" -->
* ES2015 ã‚„ Typescript ã® Modules ã® Java ç‰ˆ
<!-- .element: class="fragment" data-fragment-index="30" -->



### Java Module System ã®ä½¿ã„æ–¹

* å¿…è¦ãªãƒã‚¤ãƒŠãƒªã¯ JDK 9 ã® javac ã¨ java ã®ã¿
```bash
javac -d modules/com.lib.open src/com/lib/open/module-info.java src/com/lib/open/*
javac -p modules -d modules/com.product src/com/product/module-info.java src/com/product/Main.java
java -p modules -m com.product/com.product.Main
```
   * -p: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ¢ç´¢ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã™ã‚‹
   * -m: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ¡ã‚¤ãƒ³ ã‚¯ãƒ©ã‚¹ã‚’æŒ‡å®šã™ã‚‹

* ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå´ã§ï¼Œå…¬é–‹/éå…¬é–‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å®£è¨€ã§ãã‚‹
```java
module com.lib.open { // src/lib/module-info.java
    exports com.lib.open;
}
```
* ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå´ã§ï¼Œä½¿ç”¨/æœªä½¿ç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å®£è¨€ã§ãã‚‹
```java
module com.product { // src/product/module-info.java
    requires com.lib.open;
    //ã€€requires com.lib.close;
}
```



## Java Module System æ§‹æˆä¾‹

```bash
.
â””â”€â”€ src
    â””â”€â”€ com
        â”œâ”€â”€ lib                      (L) ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
        â”‚   â”‚
        â”‚   â”œâ”€â”€ close                 (L-1) éå…¬é–‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆã‚¯ãƒ©ã‚¹ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã¯ publicï¼‰
        â”‚   â”‚   â”œâ”€â”€ PrivateB.java
        â”‚   â”‚   â””â”€â”€ module-info.java   (L-1-1) éå…¬é–‹ã«ã™ã‚‹æ—¨ã‚’ `exports` ã«è¨˜è¿°ã™ã‚‹ï¼ˆæœªæŒ‡å®šï¼‰
        â”‚   â”‚
        â”‚   â”‚
        â”‚   â””â”€â”€ open                  (L-2) å…¬é–‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
        â”‚       â”œâ”€â”€ PublicA.java
        â”‚       â””â”€â”€ module-info.java   (L-2-1) å…¬é–‹ã«ã™ã‚‹æ—¨ã‚’ `exports` ã«è¨˜è¿°ã™ã‚‹
        â”‚
â¬†ï¸ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¬é–‹ã™ã‚‹å´
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
â¬‡ï¸ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹å´
        â”‚
        â””â”€â”€ product                  (P) ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ãŸãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ
            â”œâ”€â”€ Main.java
            â””â”€â”€ module-info.java       (P-1) ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹æ—¨ã‚’ `requires` ã«è¨˜è¿°ã™ã‚‹
```



### Java Module System ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå´ã‚³ãƒ¼ãƒ‰

* éå…¬é–‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```java
// com.lib.close.PrivateB.java
package com.lib.close; import java.util.function.Function;
public class PrivateB { // å¤–éƒ¨ã«ã¯å…¬é–‹ã—ãŸããªã„ãŒï¼Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…éƒ¨ã§ä¾å­˜ã—ã¦ã„ã‚‹ä»®å®šã§ public ã‚¯ãƒ©ã‚¹
    public Function<Integer, Integer> addOne = x -> x + 1; }
```
```java
// com.lib.close.module-file.java
module com.lib.close {
    //ã€€exports com.lib.close; // éå…¬é–‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
}
```

* å…¬é–‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```java
// com.lib.open.PublicA.java
package com.lib.open; import java.util.function.Function;
public class PublicA {
    public Function<Integer, Integer> addTwo = x -> x + 2;ã€€}
```

```java
// com.lib.open.module-file.java
module com.lib.open {
    exports com.lib.open;ã€€// å…¬é–‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
}
```



### Java Module System ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ ã‚³ãƒ¼ãƒ‰

* éå…¬é–‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ï¼Œãƒ“ãƒ«ãƒ‰ ã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ã®ã‹å®Ÿé¨“ã™ã‚‹

```java
// com.product.Main.java
package com.product;

import com.lib.open.PublicA;
import com.lib.close.PrivateB;

public class Main {
    public static void main(String[] args) {
        final PublicA a = new PublicA();
        System.out.println(a.addTwo.apply(1));

        final PrivateB b = new PrivateB();
        System.out.println(b.addOne.apply(1));
    }
}
```

```java
// com.product.module-file.java
module com.product {
    requires com.lib.open;
    //ã€€requires com.lib.close; // éå…¬é–‹ãªã®ã§èª­è¾¼ä¸å¯
}
```



### Java Module System å®Ÿè¡Œ

* Java Module System ã‚’ä½¿ã‚ãªã„ãƒ“ãƒ«ãƒ‰ ã€ŒæˆåŠŸã€

```bash
javac -d modules/com.lib.close src/com/lib/close/*
javac -d modules/com.lib.open src/com/lib/open/*
javac -d modules/com.product -cp modules/com.lib.close:modules/com.lib.open src/com/product/Main.java
java -cp modules/com.product:modules/com.lib.open:modules/com.lib.close com.product.Main
3
2
```

* Java Module System ã‚’ä½¿ã£ãŸãƒ“ãƒ«ãƒ‰ ã€Œå¤±æ•—ã€

```bash
javac -d modules/com.lib.close src/com/lib/close/module-info.java src/com/lib/close/*
javac -d modules/com.lib.open src/com/lib/open/module-info.java src/com/lib/open/*
javac -p modules -d modules/com.product src/com/product/module-info.java src/com/product/Main.java
src/com/product/Main.java:4: error: package com.lib.close does not exist
import com.lib.close.PrivateB; // éå…¬é–‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä½¿ç”¨ã‚’ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã§æ¤œå‡ºã§ãã‚‹
java -p modules -m com.product/com.product.Main
```



## Java Module System ã‚’ä½¿ã£ãŸæ„Ÿæƒ³

* ã“ã®ã‚¯ãƒ¼ãƒ«ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ã¿ã¦ï¼ã¨ã“ã‚ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã‚’èª¿ã¹ã‚‹æ–¹æ³•ã¯ï¼Ÿ 
<!-- .element: class="fragment" data-fragment-index="10" -->
 * jdeps ã‚³ãƒãƒ³ãƒ‰ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§ã‚’å–å¾—å¯èƒ½ğŸ‘
<!-- .element: class="fragment" data-fragment-index="15" -->
* module-info.java ã®åå‰ã‚’å¤‰ãˆã‚‹ã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ« ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹
<!-- .element: class="fragment" data-fragment-index="20" -->
```bash
module declarations should be in a file named module-info.java
```
<!-- .element: class="fragment" data-fragment-index="20" -->
* ä¸»è¦ IDE ã® Module ã‚µãƒãƒ¼ãƒˆãŒå¿…é ˆ
<!-- .element: class="fragment" data-fragment-index="30" -->
 * ã‚³ãƒãƒ³ãƒ‰ ãƒ“ãƒ«ãƒ‰è¾›ã„
<!-- .element: class="fragment" data-fragment-index="30" -->
 * å¾“æ¥ã®ãƒ“ãƒ«ãƒ‰æ–¹æ³•ã§ã¯ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã—ã¦ã—ã¾ã†
<!-- .element: class="fragment" data-fragment-index="30" -->
 * watch & on the fly ã® Module ãƒ“ãƒ«ãƒ‰ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œãªã„ã¨éå…¬é–‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«æ°—ã¥ãé›£ã„
<!-- .element: class="fragment" data-fragment-index="30" -->



## HTTP/2 Client

* [JEP 110: HTTP/2 Client](http://openjdk.java.net/jeps/110)
* 1999 å¹´ 6 æœˆ RFC 2616 HTTP/1.1
<!-- .element: class="fragment" data-fragment-index="10" -->
* 2015 å¹´ 5 æœˆ RFC 7540 HTTP/2 ãŒæ¨™æº–åŒ–
<!-- .element: class="fragment" data-fragment-index="10" -->
* HTTP ã® Head-of-line Blocking (HoL) ã§åŒæ™‚æ¥ç¶šæ•°ãŒåˆ¶é™ã•ã‚Œã¦ã„ãŸ
<!-- .element: class="fragment" data-fragment-index="20" -->
 * ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§ concatï¼Œminifyï¼ŒCSS ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆï¼ŒCSS ã‚„ç”»åƒã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–ãªã©ã®åŠªåŠ›ã‚’ã—ã¦ã„ãŸ
<!-- .element: class="fragment" data-fragment-index="20" -->
* ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å¤šé‡åŒ–ï¼Œãƒ˜ãƒƒãƒ€ã®åœ§ç¸®ï¼Œãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ãªã©ã§æ”¹å–„ï¼ˆã–ã£ãã‚ŠğŸ™‡ï¼‰
<!-- .element: class="fragment" data-fragment-index="25" -->
* JDK 9 HttpClient ä»¥å¤–ã® HTTP/2 Client
<!-- .element: class="fragment" data-fragment-index="30" -->
 * [Jetty Client](http://www.eclipse.org/jetty/documentation/current/http2.html)
<!-- .element: class="fragment" data-fragment-index="30" -->
 * [Netty Client](http://netty.io/)
<!-- .element: class="fragment" data-fragment-index="30" -->
 * [OkHttp Client](http://square.github.io/okhttp/)
<!-- .element: class="fragment" data-fragment-index="30" -->



## HTTP/2 Client ä½¿ã„æ–¹

* Java Module System ã§ `java.httpclient` ã‚’ requires ã™ã‚‹

```java
// src/com/product/module-info.java
module com.product {
    requires java.httpclient;
}
```

```java
// src/com/product/Main.java
final CompletableFuture<String> bodyAsync = HttpClient.create().build()
        .request(URI.create("https://twitter.com/"))
        //.version(HttpClient.Version.HTTP_2) // java.io.IOException: Connection aborted
        .GET()
        .responseAsync()
        .thenCompose(response -> {
            if (response.statusCode() == 200) {
                return response.bodyAsync(HttpResponse.asString());
            } else {
                return CompletableFuture.completedFuture(null);
            }
        })
        .thenApply(body -> body);

System.out.println(bodyAsync.get());
```

```java
javac -d modules/com.product src/com/product/module-info.java src/com/product/Main.java
java -p modules -m com.product/com.product.Main
```



## HTTP/2 Client ã‚’ä½¿ã£ãŸæ„Ÿæƒ³

* æ—©é€Ÿ Module System ãŒå¿…è¦ãªã®ã‹ï¼ŒãŠå‰ã¯ã€‚ã€‚ã€‚
<!-- .element: class="fragment" data-fragment-index="10" -->



## ç¶šãã¯ Qiita ã§ï¼

* Qiita, ã€Œä»Šã®ã†ã¡ã«çŸ¥ã£ã¦ãŠããŸã„ã€ã‹ã‚†ã„æ‰€ã«æ‰‹ãŒå±ŠãJava9ã®æ–°æ©Ÿèƒ½7é¸ã€, http://qiita.com/kashira2339/items/ce99d370eabbf2d66ded
* Qiita, ã€ŒJava9ã§è¿½åŠ ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§ã¨ãã®ä½¿ã„æ–¹ã€, http://qiita.com/hcl/items/c684aa1b85d2425f0151
* Qiita, ã€ŒJava9ã§æ–‡å­—åˆ—ã®çµåˆã®é€Ÿåº¦ã‚’ç¢ºèªã™ã‚‹ã€, http://qiita.com/deaf_tadashi/items/73b9d4ecbfe6f8b14e8f



# Thanks!



## å‚è€ƒãƒãƒ¼ãƒˆ

* Wikipedia, "Java version history - Java SE 9", https://en.wikipedia.org/wiki/Java_version_history#Java_SE_9
* Open JDK, "JDK 9", http://openjdk.java.net/projects/jdk9/
* Ben Evance, ã€Œãƒ—ãƒ¬ãƒªãƒªãƒ¼ã‚¹ç‰ˆã§å­¦ã¶Java 9ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€, http://www.oracle.com/webfolder/technetwork/jp/javamagazine/Java-JF16-Java9Modules.pdf
* Wikipedia, ã€ŒHTTP/2ã€, https://ja.wikipedia.org/wiki/HTTP/2
* HTTP/2 and REST, "HTTP/2 Java Client Examples", http://unrestful.io/2015/10/10/http2-java-client-examples.html
* ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±‹blog,ã€ŒHTTP/2ã®ç‰¹å¾´ HTTP/1.1ã¨ã®é•ã„ã«ã¤ã„ã¦ã€, http://blog.redbox.ne.jp/http2-cdn.html
* Stackoverflow, "â€œpackage java.net.http does not existâ€ error on JDK9", http://stackoverflow.com/questions/36910746/package-java-net-http-does-not-exist-error-on-jdk9
